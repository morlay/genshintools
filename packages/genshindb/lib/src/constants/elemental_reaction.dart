import 'package:freezed_annotation/freezed_annotation.dart';
import 'package:genshindb/annotations.dart';
import 'package:genshindb/utils.dart';

part '__generated__/elemental_reaction.g.dart';

class ElementalReactionStringConverter
    extends _$ElementalReactionStringConverter {
  const ElementalReactionStringConverter() : super();
}

@JsonEnum(alwaysCreate: true)
enum ElementalReaction {
  @EnumMeta(label: "融化")
  Melt,

  @EnumMeta(label: "蒸发")
  Vaporize,

  @EnumMeta(label: "扩散")
  Swirl,

  @EnumMeta(label: "超导")
  SuperConduct,

  @EnumMeta(label: "感电")
  ElectroCharged,

  @EnumMeta(label: "超载")
  Overloaded,

  @EnumMeta(label: "碎冰")
  Shattered,

  @EnumMeta(label: "结晶")
  Crystallize,
}

extension ElementalReactionHurts on ElementalReaction {
  double elementMasterAddHurt(double elementMaster) {
    var k = 4.44;
    var a = 1400;
    switch (ElementalReaction.values[index]) {
      case ElementalReaction.Melt:
      case ElementalReaction.Vaporize:
        k = 2.78;
        break;
      case ElementalReaction.SuperConduct:
      case ElementalReaction.Swirl:
      case ElementalReaction.ElectroCharged:
      case ElementalReaction.Overloaded:
      case ElementalReaction.Shattered:
        k = 16;
        a = 2000;
        break;
      default:
    }
    return (k * elementMaster) / (elementMaster + a);
  }

  double characterHurtBase(int characterLevel) {
    return levelRadio(characterLevel) *
        (elementalReactionRatios[ElementalReaction.values[index]] ?? 1);
  }
}

Map<ElementalReaction, double> elementalReactionRatios = {
  ElementalReaction.SuperConduct: 1,
  ElementalReaction.Swirl: 1.2,
  ElementalReaction.ElectroCharged: 2.4,
  ElementalReaction.Shattered: 3,
  ElementalReaction.Overloaded: 4,
};

double levelRadio(int level) {
  return levelRadios[rangeLimit(level, 1, 90) - 1] / 2;
}

// https://genshin.mingyulab.com/game_system/elemental_reaction
// see sources to find Zs in main.js, l1,l2,l3
List<double> levelRadios = [
  17.165605545043945,
  18.53504753112793,
  19.90485382080078,
  21.27490234375,
  22.64539909362793,
  24.649612426757812,
  26.640642166137695,
  28.868587493896484,
  31.367679595947266,
  34.14334487915039,
  37.20100021362305,
  40.65999984741211,
  44.4466667175293,
  48.56351852416992,
  53.74848175048828,
  59.0818977355957,
  64.4200439453125,
  69.72445678710938,
  75.12313842773438,
  80.58477783203125,
  86.11203002929688,
  91.70374298095703,
  97.24462890625,
  102.8126449584961,
  108.40956115722656,
  113.20169067382812,
  118.1029052734375,
  122.97931671142578,
  129.72732543945312,
  136.29290771484375,
  142.6708526611328,
  149.02902221679688,
  155.4169921875,
  161.82550048828125,
  169.10630798339844,
  176.51808166503906,
  184.07273864746094,
  191.7095184326172,
  199.55691528320312,
  207.38204956054688,
  215.39889526367188,
  224.16566467285156,
  233.50216674804688,
  243.35057067871094,
  256.0630798339844,
  268.5434875488281,
  281.52606201171875,
  295.0136413574219,
  309.06719970703125,
  323.6015930175781,
  336.7575378417969,
  350.5303039550781,
  364.4826965332031,
  378.6191711425781,
  398.60040283203125,
  416.39825439453125,
  434.3869934082031,
  452.9510498046875,
  472.6062316894531,
  492.8848876953125,
  513.5685424804688,
  539.1032104492188,
  565.5105590820312,
  592.5387573242188,
  624.4434204101562,
  651.4701538085938,
  679.496826171875,
  707.7940673828125,
  736.6714477539062,
  765.6402587890625,
  794.7733764648438,
  824.6773681640625,
  851.1577758789062,
  877.7420654296875,
  914.2291259765625,
  946.7467651367188,
  979.411376953125,
  1011.2230224609375,
  1044.791748046875,
  1077.4437255859375,
  1109.99755859375,
  1142.9765625,
  1176.3695068359375,
  1210.1844482421875,
  1253.835693359375,
  1288.9527587890625,
  1325.484130859375,
  1363.4569091796875,
  1405.097412109375,
  1446.853515625,
  1488.215576171875,
  1528.444580078125,
  1580.367919921875,
  1630.8475341796875,
  1711.19775390625,
  1780.4539794921875,
  1847.32275390625,
  1911.474365234375,
  1972.8643798828125,
  2030.07177734375,
  2084.6357421875,
  2139.05029296875,
  2193.21337890625,
  2234.17333984375,
  2284.82421875,
  2303.821533203125,
  2322.8798828125,
  2341.99951171875,
  2361.1806640625,
  2380.42333984375,
  2399.727783203125,
  2419.09423828125,
  2438.5224609375,
  2458.01318359375,
  2491.48095703125,
  2515.023681640625,
  2538.6435546875,
  2562.340576171875,
  2586.114990234375,
  2609.96728515625,
  2633.897216796875,
  2657.905029296875,
  2681.9912109375,
  2706.15576171875,
  2730.39892578125,
  2740.8056640625,
  2751.238037109375,
  2761.696044921875,
  2772.1796875,
  2782.68896484375,
  2793.223876953125,
  2803.78466796875,
  2814.371337890625,
  2824.98388671875,
  2835.622314453125,
  2846.28662109375,
  2856.977294921875,
  2867.69384765625,
  2878.436767578125,
  2889.20556640625,
  2900.0009765625,
  2910.822509765625,
  2921.67041015625,
  2932.544921875,
  2943.44580078125,
  2954.373291015625,
  2965.3271484375,
  2976.307861328125,
  2987.315185546875,
  2998.349365234375,
  3009.41015625,
  3020.498046875,
  3031.61279296875,
  3042.75439453125,
  3053.923095703125,
  3065.118896484375,
  3076.341796875,
  3087.591796875,
  3098.869140625,
  3110.173828125,
  3121.505615234375,
  3132.864990234375,
  3144.251953125,
  3155.666259765625,
  3167.10791015625,
  3178.577392578125,
  3190.07470703125,
  3201.599609375,
  3213.152099609375,
  3224.732666015625,
  3236.341064453125,
  3247.977294921875,
  3259.6416015625,
  3271.333984375,
  3283.054443359375,
  3294.802978515625,
  3306.579833984375,
  3318.384765625,
  3330.218017578125,
  3342.079833984375,
  3353.969970703125,
  3365.888671875,
  3377.835693359375,
  3389.8115234375,
  3401.81591796875,
  3413.848876953125,
  3425.910888671875,
  3438.00146484375,
  3450.120849609375,
  3462.269287109375,
  3474.446533203125,
  3486.65283203125,
  3498.888427734375,
  3511.15283203125,
  3523.446533203125,
  3535.623046875,
  3547.97509765625,
  3560.356201171875,
  3572.766845703125,
  3585.20703125,
];
